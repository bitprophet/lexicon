version: 2.1

orbs:
  # TODO: rename the map itself
  bitprophet: invocations/orb@dev:first-steps

workflows:
  main:
    jobs:
      - bitprophet/lint:
          name: Lint
      - bitprophet/format:
          name: Style check
      - bitprophet/coverage:
          name: Test 3.6 (w/ coverage)
          context: lexicon
      - bitprophet/test-release:
          name: Release test
          context: lexicon
      - bitprophet/test:
          name: Test << matrix.version >>
          # It's not worth testing on other interpreters if the baseline one
          # failed. Can't run >4 jobs at a time anyhow!
          requires: ["Test 3.6 (w/ coverage)"]
          matrix:
            parameters:
              version: ["3.7", "3.8", "3.9"]
